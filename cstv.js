var _gaq=_gaq||[];_gaq.push(['_setAccount','UA-695498-6']);_gaq.push(['_setDomainName','.churchservices.tv']);_gaq.push(['_trackPageview']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'==document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();jQuery(document).ready(function(){jQuery('.video-js').bind('contextmenu',function(){return false;});jQuery('.vid-url').click(function(e){e.preventDefault();jQuery("iframe",jQuery("#vid-lightbox")).attr('src',jQuery(this).attr('href'));jQuery('#vid-lightbox').fadeToggle('fast');});jQuery('#vid-lightbox').click(function(){jQuery(this).fadeToggle();jQuery("iframe",jQuery("#vid-lightbox")).attr('src','');jQuery("#dynamicframe #document").remove();});jQuery(".page-id-126 .embed-youtube").unwrap();});jQuery(document).ready(function(){jQuery(".nav-tabs a").click(function(e){e.preventDefault();jQuery(this).tab('show');});jQuery(document).on('click','.church-schedule-container .prev-tab',function(e){var dayCount=jQuery(".days").val();;var churchId=jQuery(".church_id").val();var dayCountAdded=parseInt(dayCount)-7;jQuery.ajax({type:'GET',url:'/index.php',data:'?get_schedules=1&days='+dayCountAdded+'&church_id='+churchId,beforeSend:function(){jQuery('.church_schedule_tabs_container').html('<div style="margin-left: auto;margin-right: auto;text-align:center;padding-top:50px;"><i class="fa fa-spinner fa-spin" style="font-size:24px"></i>');},success:function(data){jQuery('.church-schedule-container').replaceWith(data);jQuery(".days").val(dayCountAdded);}});e.preventDefault();return false;});jQuery(document).on('click','.church-schedule-container .next-tab',function(e){var dayCount=jQuery(".days").val();;var churchId=jQuery(".church_id").val();var dayCountAdded=parseInt(dayCount)+7;jQuery.ajax({type:'GET',url:'/index.php',data:'?get_schedules=1&days='+dayCountAdded+'&church_id='+churchId,beforeSend:function(){jQuery('.church_schedule_tabs_container').html('<div style="margin-left: auto;margin-right: auto;text-align:center;padding-top:50px;"><i class="fa fa-spinner fa-spin" style="font-size:24px"></i>');},success:function(data){jQuery('.church-schedule-container').replaceWith(data);jQuery(".days").val(dayCountAdded);}});e.preventDefault();return false;});jQuery(".click-schedule").click(function(){window.location=jQuery(this).data("href");});function toggleChevron(e){jQuery(e.target).prev('.panel-heading').find("i.indicator").toggleClass('glyphicon-chevron-down glyphicon-chevron-up');}
jQuery('#accordion').on('hidden.bs.collapse',toggleChevron);jQuery('#accordion').on('shown.bs.collapse',toggleChevron);jQuery('#findchurch').submit(function(e){e.preventDefault();});});jQuery(document).ready(function(){if(jQuery('.clock_face')!=null){function clock(){var t=moment(),a=t.minutes()*6,o=t.hours()%12/12*360+(a/12);jQuery(".hour").css("transform","rotate("+o+"deg)");jQuery(".minute").css("transform","rotate("+a+"deg)");}
function refreshClock(){clock(),setTimeout(refreshClock,1000);jQuery('#clockid').html(moment().format("[<b>]MMMM Do[</b>]"));jQuery('.clock_time').html(moment().format("HH:mm"));}
refreshClock();}});jQuery(document).ready(function(){jQuery(".church-map-modal-link").click(function(event){event.preventDefault();jQuery("#openModal-0").fadeToggle("fast");});jQuery(".close").click(function(event){event.preventDefault();jQuery("#openModal-0").fadeToggle("fast");});jQuery('#church-details-button').bind('click',function(e){jQuery('#church-details-panel').toggle();});jQuery(".church-single-container #church-player-content .playlist_container .playlist-row").click(function(event){event.preventDefault();var videoswitch=jQuery(this).attr('data-src');var video_id=jQuery(this).attr('data-id');var video_title=jQuery(this).attr('data-title');var video_description=jQuery(this).attr('data-description');var video_download_link=jQuery(this).attr('data-download-link');if(videoswitch!=""){jQuery("#tab-ondemand").tab("show");jQuery('.playlist-static-column-container .playlist_container .playlist-highlight').removeClass('playlist-highlight');jQuery('.playlist-static-column-container .playlist-static-'+video_id).addClass("playlist-highlight");jQuery('#player-2 .archive-indicator').removeClass('hidden');jQuery('.church-single-container .video-title').html(video_title);jQuery('.church-single-container .video-description').html(video_description);if(video_download_link!="")jQuery('.church-single-container .video-download-link').html('<a href="'+video_download_link+'">Download Video</a>');var parent_div=jQuery(".playlist-static-column-container  .playlist-schedule");var now_playing_div=jQuery(".playlist-static-"+video_id);if(jQuery('.playlist-static-column-container  .playlist-schedule').length){jQuery(parent_div).scrollTop(jQuery(now_playing_div).position().top);}
playerLive.pause();playerOnDemand.autoplay('play');playerOnDemand.preload('true');playerOnDemand.src({src:videoswitch,type:'application/x-mpegurl'});playerOnDemand.play();console.log("currentclick:"+playerLive.currentSrc());}});jQuery(".backlive h3").click(function(event){event.preventDefault();var videoswitch=jQuery(this).attr('data-src');if(videoswitch!=""){jQuery("#tab-livetv").tab("show");jQuery('.playlist-static-column-container .playlist_container .playlist-highlight').removeClass('playlist-highlight');jQuery('.church-single-container .video-title').html("");jQuery('.church-single-container .video-download-link').html("");if(videoswitch.search("stream/playlist")>0){}
playerLive.src({src:videoswitch,type:'application/x-mpegurl'});playerOnDemand.pause();console.log("currentclick:"+playerOnDemand.currentSrc());}});jQuery('.church-single-container .stream-tabs a').click(function(event){event.preventDefault();var streamswitch=jQuery(this).attr('data-src');if(streamswitch!=""){jQuery('.load-stream').removeClass('active');jQuery(this).addClass('active');playerLive.src({src:streamswitch,type:'application/x-mpegurl'});jQuery(".backlive h3").data('src',streamswitch);jQuery('.responsive-player-container .vjs-modal-dialog').addClass('vjs-hidden');console.log("tabswitch - current:"+playerLive.currentSrc());}});jQuery('.player-tabs a').bind('click',function(e){var currentTab=jQuery(event.target).attr("data-target");var previousTab=jQuery(event.relatedTarget).attr("data-target");if(currentTab=="#player-1"){playerLive.play();playerOnDemand.pause();}else{playerLive.pause();}})
jQuery('.embed-player-tabs a').bind('click',function(e){var currentTab=jQuery(event.target).attr("data-target");var previousTab=jQuery(event.relatedTarget).attr("data-target");if(currentTab=="#tab-player"){}else{playerLive.pause();}})});jQuery(document).ready(function(){jQuery('.church-archives-container #video-1 .pagination a').click(function(event){event.preventDefault();var page_link=jQuery(this).attr('href');var church_id=getParameterByName('church_id',page_link);var page_number=getParameterByName('page_number',page_link);jQuery.ajax({type:'GET',url:'/index.php',data:'get_videos=1&church_id='+church_id+'&video_type=recording&page_number='+page_number,success:function(data){jQuery(".church-archives-container #video-1 .playlist_container").html(data);}});jQuery(".church-archives-container #video-1 .pagination li").removeClass("active");jQuery(this).addClass("current");jQuery(this).parent().addClass("active");});jQuery('.church-archives-container #video-2 .pagination a').click(function(event){event.preventDefault();var church_id=jQuery(this).attr('data-church-id');var page_link=jQuery(this).attr('href');var church_id=getParameterByName('church_id',page_link);var page_number=getParameterByName('page_number',page_link);jQuery.ajax({type:'GET',url:'/index.php',data:'get_videos=1&church_id='+church_id+'&video_type=upload&page_number='+page_number,success:function(data){jQuery(".church-archives-container #video-2 .playlist_container").html(data);}});jQuery(".church-archives-container #video-2 .pagination li").removeClass("active");jQuery(this).addClass("current");jQuery(this).parent().addClass("active");});jQuery(".church-archives-container #video-1 .playlist-row.cstv-inline").live("click",function(event){event.preventDefault();var video_id=jQuery(this).attr('data-id');var recording=jQuery(this).attr('data-src');var recording_title=jQuery(this).attr('data-title');var recording_url=jQuery(this).attr('data-url');console.log("recording:".recording);jQuery('.church-archives-container #video-1 #churchPlayerRecording').removeClass('hidden');playerRecording.src({src:recording,type:'application/x-mpegurl'});playerRecording.play();if(jQuery('#churchPlayerLive').length>0){playerLive.pause();}
if(jQuery('#churchPlayerUpload').length>0)playerUpload.pause();jQuery(".church-archives-container #video-1 .video-title").html(recording_title);if(recording_url!="")jQuery(".church-archives-container #video-1 .video-link").html("<a href='"+recording_url+"' target='_blank'>Download Video</a>");jQuery('.church-archives-container #video-1 .playlist-row').removeClass('playlist-highlight');jQuery('.church-archives-container #video-1 .playlist-'+video_id).addClass("playlist-highlight");});jQuery(".church-archives-container #video-2 .playlist-row.cstv-inline").live("click",function(event){event.preventDefault();var video_id=jQuery(this).attr('data-id');var recording=jQuery(this).attr('data-src');var recording_title=jQuery(this).attr('data-title');var recording_description=jQuery(this).attr('data-description');var recording_url=jQuery(this).attr('data-url');jQuery('.church-archives-container #video-2 #churchPlayerUpload').removeClass('hidden');playerUpload.src({src:recording,type:'application/x-mpegurl'});playerUpload.play();if(jQuery('#churchPlayerLive').length>0){playerLive.pause();}
if(jQuery('#churchPlayerRecording').length>0)playerRecording.pause();jQuery(".church-archives-container #video-2 .video-title").html(recording_title);jQuery(".church-archives-container #video-2 .video-description").html(recording_description);if(recording_url!="")jQuery(".church-archives-container #video-2 .video-link").html("<a href='"+recording_url+"' target='_blank'>Download Video</a>");jQuery('.church-archives-container #video-2 .playlist-row').removeClass('playlist-highlight');jQuery('.church-archives-container #video-2 .playlist-'+video_id).addClass("playlist-highlight");});jQuery(".church-archives-container #video-1 .cstv-outline").live("click",function(event){window.location=jQuery(this).attr('data-redirect');});jQuery(".church-archives-container #video-2 .cstv-outline").live("click",function(event){window.location=jQuery(this).attr('data-redirect');});});jQuery('.recording-search-submit').click(function(event){event.preventDefault();var keyword=jQuery("#search_keyword").val();var recording_from=jQuery("#recording_from").val();var recording_to=jQuery("#recording_to").val();var currentTab=jQuery(".church-archives-container li.active a").attr("data-target");var currentTabName=jQuery(".church-archives-container li.active a").attr("data-title");var currentTabClass=jQuery(".church-archives-container li.active a").attr("data-class");var video_type="recording"
if(currentTab=="#video-2")video_type="upload";var church_id=jQuery("#search_church_id").val();jQuery.ajax({type:'GET',url:'/index.php',data:'get_videos=1&church_id='+church_id+'&video_type='+video_type+'&page_number=1&recording_from='+recording_from+'&recording_to='+recording_to+'&keyword='+keyword,success:function(data){jQuery("#church-video-content "+currentTab+" .search-results").html("<h4 style='cursor:pointer;text-align:center;'>Search Results</h4>"+data);}});});jQuery(document).ready(function(){if(!sessionStorage.getItem('cstv_timezone')){var tz=jstz.determine()||'UTC';sessionStorage.setItem('cstv_timezone',tz.name());}
var currTz=sessionStorage.getItem('cstv_timezone');var currTzAbbrev=moment().tz(moment.tz.guess()).format('zz');var date=moment().tz("Europe/London").format("YYYY-MM-DD");var offset_hour="+01:00";if(moment().isDST())offset_hour="+00:00";else offset_hour="+01:00";jQuery('.schedule-accordion').each(function(){var inputTime=jQuery(this).data('src');var stamp=date+"T"+inputTime+offset_hour;var momentTime=moment(stamp);var tzTime=momentTime.tz(currTz);var formattedTime=tzTime.format('HH:mm');var formattedTime2=tzTime.add(60,'minutes').format('HH:mm');var dt=jQuery(this).data('fullsrc');var m=moment.tz(dt,"Europe/London");var newtime=m.clone().tz(currTz).format("HH:mm");var newtime2=m.clone().add(60,'minutes').tz(currTz).format("HH:mm");jQuery(this).html('<span class="glyphicon glyphicon-plus"></span> '+newtime+" to "+newtime2);});jQuery('.church-daily-schedule-time').each(function(){var inputTime=jQuery(this).data('src');var stamp=date+"T"+inputTime+offset_hour;var momentTime=moment(stamp);var tzTime=momentTime.tz(currTz);var formattedTime=tzTime.format('HH:mm');var dt=jQuery(this).data('fullsrc');var m=moment.tz(dt,"Europe/London");var newtime=m.clone().tz(currTz).format("HH:mm");jQuery(this).html(newtime);});jQuery("#timezone-display").html(currTzAbbrev);jQuery('.schedule-type .playlist-time').each(function(){var inputTime=jQuery(this).data('src');var stamp=date+"T"+inputTime+offset_hour;var momentTime=moment(stamp);var tzTime=momentTime.tz(currTz);var formattedTime=tzTime.format('HH:mm');var dt=jQuery(this).data('fullsrc');var m=moment.tz(dt,"Europe/London");var newtime=m.clone().tz(currTz).format("HH:mm");jQuery(this).html(newtime);});});function getParameterByName(name,url){if(!url)url=window.location.href;name=name.replace(/[\[\]]/g,'\\$&');var regex=new RegExp('[?&]'+name+'(=([^&#]*)|&|#|$)'),results=regex.exec(url);if(!results)return null;if(!results[2])return '';return decodeURIComponent(results[2].replace(/\+/g,' '));}
(function($,window,document,undefined){"use strict";var pluginName='playlistManager';function Plugin(element,options){var defaults={church_id:"",playlist_id:"",player:"",autoRefreshEvents:false,};this.element=element;this.options=$.extend({},defaults,options);this._name=pluginName;this.timer;this.eventList;this.live;this.first_call=1;this._init();}
Plugin.prototype={_init:function(){var _self=this;console.log("Plugin Initialized");_self.refreshEvents();_self._startTimer();},_startTimer:function(){var _self=this;console.log("Timer Started");_self.timer=setInterval(function(){_self._processEvents();},60*1000);},_processEvents:function(){var _self=this;var currTz=sessionStorage.getItem('cstv_timezone');var current_time=moment(new Date()).format("YYYY-MM-DD HH:mm");jQuery.each(_self.eventList,function(i,item){var start_time=item.start_time;var start_date=new Date(item.start_time*1000);var local_start_time=moment.unix(item.start_time).tz(currTz).format("YYYY-MM-DD HH:mm");if(local_start_time==current_time){console.log("found a match: "+local_start_time);switch(item.type){case "start_stream":_self._startLiveStream(item);break;case "end_stream":_self._endLiveStream(item);break;case "switch_playlist":_self._switchPlaylist(item);break;case "end_playlist":_self._endPlaylist(item);break;}}});},_startLiveStream:function(item){var _self=this;console.log("Live Stream Started: "+item.start_time);if(item.password==1)location.reload();if(item.playlist_exists==1){console.log("Switched to Live: "+item.stream);jQuery(".backlive h3").attr('data-src',jQuery(".default-stream").data("src"));if(jQuery(".playlist-column-container .playlist-schedule").length>0){jQuery('#player-1 .archive-indicator').addClass('hidden');jQuery('#player-1 .recording-indicator').removeClass('hidden');jQuery('#player-1 .playlist_container .playlist-highlight').removeClass('playlist-highlight');jQuery('#player-1 .schedule-'+item.id).addClass("playlist-highlight");if(jQuery('#player-1 .schedule-column-container  .playlist-schedule').length){var parent_div=jQuery("#player-1 .schedule-column-container  .playlist-schedule");var now_playing_div=jQuery("#player-1 .playlist-"+item.id);if(now_playing_div.length>0)jQuery(parent_div).scrollTop(jQuery(now_playing_div).position().top);}}
var player_name="playerLive";var playerStatus=1;if(_self.player)player_name=_self.player;console.log("Player pause status: "+playerLive.paused());if(playerLive.paused()=="true")playerStatus="";playerLive.src({src:item.stream,type:'application/x-mpegurl'});playerLive.load();playerLive.play();}
_self.live=1;},_endLiveStream:function(item){var _self=this;console.log("Live Stream Ended: "+item.start_time);_self.live=0;if(item.playlist_exists==1){var r=Math.floor(Math.random()*1000001);window.location=window.location.href+'?r='+r;_self.refreshEvents();var latest_playlist_url=item.playlist_url;jQuery.each(_self.eventList,function(i,item2){latest_playlist_url=item2.playlist_url;});console.log("Latest Playlist: "+latest_playlist_url);if(latest_playlist_url){console.log("Switched to Playlist: "+latest_playlist_url);var playerStatus=1;console.log("Player pause status: "+playerLive.paused());if(playerLive.paused()=="true")playerStatus="";playerLive.src({src:"https://m4s4i7t5.stackpathcdn.com/CSTV-HTTP/"+latest_playlist_url+"/playlist.m3u8",type:'application/x-mpegurl'});playerLive.load();playerLive.play();if(jQuery(".playlist-column-container .playlist-schedule").length>0){var r=Math.floor(Math.random()*1000001);jQuery.get('/wp-content/uploads/playlist-cache/'+latest_playlist_url+'.txt?r='+r,function(data){var playlist_arr=JSON.parse(data);jQuery(".backlive h3").attr('data-src',"https://m4s4i7t5.stackpathcdn.com/CSTV-HTTP/"+item.playlist_url+"/playlist.m3u8");jQuery('#player-1 .archive-indicator').removeClass('hidden');jQuery('#player-1 .recording-indicator').addClass('hidden');jQuery("#player-1 .schedule-type.playlist-highlight").next().removeClass("hidden");jQuery("#player-1 .schedule-type.playlist-highlight").addClass("hidden");jQuery('#player-1 .playlist_container .playlist-highlight').removeClass('playlist-highlight');jQuery('#player-1 .playlist-'+playlist_arr.video_id).addClass("playlist-highlight");if(jQuery('#player-1 .playlist-column-container  .playlist-schedule').length){var parent_div=jQuery("#player-1 .playlist-column-container .playlist-schedule");var now_playing_div=jQuery("#player-1 .playlist-"+playlist_arr.video_id);if(now_playing_div.length>0)jQuery(parent_div).scrollTop(jQuery(now_playing_div).position().top);}});}}}},_switchPlaylist:function(item){var _self=this;if(_self.live!=1){console.log("Playlist Switched");var r=Math.floor(Math.random()*1000001);window.location=window.location.href+'?r='+r;}},_endPlaylist:function(item){var _self=this;if(_self.live!=1){console.log("Playlist Ended");var r=Math.floor(Math.random()*1000001);window.location=window.location.href+'?r='+r;}},refreshEvents:function(){var _self=this;var r=Math.floor(Math.random()*1001);jQuery.ajax({type:"GET",dataType:"json",url:"/index.php",data:{church_id:_self.options.church_id,playlist_id:_self.options.playlist_id,get_schedules_playlists:1,r:r},success:function(response){console.log(response);_self.eventList=response;jQuery.each(_self.eventList,function(i,item){if(_self.first_call==1){_self.first_call=2;var r=Math.floor(Math.random()*1000001);if(playerLive.currentSrc()=="https://m4s4i7t5.stackpathcdn.com/CSTV-HTTP/"+item.playlist_url+"/playlist.m3u8"&&item.live==1){_self._startLiveStream(item);console.log("Started Live Stream");window.location=window.location.href+'?r='+r;return false;}else if(playerLive.currentSrc()==item.stream&&item.playlist_exists==1&&item.live!=1){console.log("Started Playlist - "+playerLive.currentSrc()+" --"+item.stream+" -- "+item.live);window.location=window.location.href+'?r='+r;return false;}}});}});},destroy:function(){jQuery(this.loadingIcon).remove();jQuery.removeData(this.element,pluginName);}};jQuery.fn[pluginName]=function(options){return this.each(function(){if(!jQuery.data(this,pluginName)){jQuery.data(this,pluginName,new Plugin(this,options));}});};})(jQuery,window,document);